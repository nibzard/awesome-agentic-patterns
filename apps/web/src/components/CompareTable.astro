---
interface Pattern {
  id: string;
  title: string;
  status: string;
  category: string;
  maturity?: string;
  complexity?: string;
  effort?: string;
  impact?: string;
  tags?: string[];
  domains?: string[];
}

interface Props {
  patterns: Pattern[];
}

const { patterns } = Astro.props;

// Fields to compare
const compareFields = [
  { key: 'status', label: 'Status' },
  { key: 'category', label: 'Category' },
  { key: 'maturity', label: 'Maturity' },
  { key: 'complexity', label: 'Complexity' },
  { key: 'effort', label: 'Effort' },
  { key: 'impact', label: 'Impact' },
  { key: 'tags', label: 'Tags' },
  { key: 'domains', label: 'Domains' },
];

const formatValue = (value: string | string[] | undefined): string => {
  if (!value) return 'â€”';
  if (Array.isArray(value)) {
    return value.slice(0, 3).join(', ') + (value.length > 3 ? '...' : '');
  }
  return value.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
};
---

{patterns.length > 0 ? (
  <div class="compare-table-wrapper">
    <table class="compare-table">
      <thead>
        <tr>
          <th class="compare-table-row-label">Field</th>
          {patterns.map(pattern => (
            <th class="compare-table-header">
              <a href={`/patterns/${pattern.id}`} class="compare-table-title">
                {pattern.title}
              </a>
            </th>
          ))}
        </tr>
      </thead>
      <tbody>
        {compareFields.map(field => (
          <tr class:list={['compare-table-row', { 'compare-table-row--alt': compareFields.indexOf(field) % 2 === 0 }]}>
            <td class="compare-table-row-label">{field.label}</td>
            {patterns.map(pattern => (
              <td class="compare-table-cell">
                {field.key === 'tags' || field.key === 'domains' ? (
                  <div class="compare-table-tags">
                    {(pattern[field.key as keyof Pattern] as string[])?.slice(0, 3).map((item: string) => (
                      <span class="compare-table-tag">{item}</span>
                    ))}
                    {(pattern[field.key as keyof Pattern] as string[])?.length > 3 && (
                      <span class="compare-table-more">
                        +{(pattern[field.key as keyof Pattern] as string[]).length - 3}
                      </span>
                    )}
                  </div>
                ) : (
                  <span>{formatValue(pattern[field.key as keyof Pattern] as string | string[])}</span>
                )}
              </td>
            ))}
          </tr>
        ))}
      </tbody>
    </table>
  </div>
) : (
  <div class="compare-table-empty">
    <p>No patterns selected for comparison.</p>
    <a href="/patterns" class="button">Browse Patterns</a>
  </div>
)}

<style>
  .compare-table-wrapper {
    overflow-x: auto;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
  }

  .compare-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
  }

  .compare-table th,
  .compare-table td {
    padding: var(--spacing-md);
    text-align: left;
    border-bottom: 1px solid var(--color-divider);
  }

  .compare-table-header {
    background-color: var(--color-border);
    font-weight: 600;
    min-width: 200px;
  }

  .compare-table-title {
    color: var(--color-text);
    text-decoration: none;
    font-size: 1rem;
    display: block;
  }

  .compare-table-title:hover {
    color: var(--color-primary);
  }

  .compare-table-row-label {
    font-weight: 500;
    color: var(--color-text-muted);
    background-color: var(--color-bg);
    position: sticky;
    left: 0;
  }

  .compare-table-row--alt .compare-table-row-label {
    background-color: var(--color-bg);
  }

  .compare-table-cell {
    font-size: 0.875rem;
    color: var(--color-text);
    min-width: 150px;
  }

  .compare-table-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
  }

  .compare-table-tag {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    background-color: var(--color-border);
    padding: 2px 8px;
    border-radius: var(--radius-sm);
  }

  .compare-table-more {
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  .compare-table-empty {
    text-align: center;
    padding: var(--spacing-2xl);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
  }

  .compare-table-empty p {
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-lg);
  }

  .button {
    display: inline-block;
    padding: var(--spacing-sm) var(--spacing-xl);
    background-color: var(--color-primary);
    color: white;
    text-decoration: none;
    border-radius: var(--radius-md);
    font-weight: 500;
    transition: background-color 0.2s ease;
  }

  .button:hover {
    background-color: var(--color-primary-hover);
  }
</style>
