{
  "title": "Curated Code Context Window",
  "status": "validated-in-production",
  "authors": [
    "Nikola Balic (@nibzard)"
  ],
  "based_on": [
    "Anonymous Speaker (Open Source Agent RL Talk)",
    "Will Brown (Prime Intellect Talk)",
    "Thorsten Ball"
  ],
  "category": "Context & Memory",
  "source": "https://www.youtube.com/watch?v=Xkwok_XXQgw",
  "tags": [
    "context-management",
    "code-agent",
    "file-selection",
    "noise-reduction"
  ],
  "slug": "curated-code-context-window",
  "id": "curated-code-context-window",
  "summary": "Maintain minimal, high-signal code context using search subagents to identify and inject only relevant modules, preventing model overwhelm, reducing token usage, and improving reasoning clarity by excluding unrelated code.",
  "updated_at": "2026-01-05",
  "body": "\n## Problem\n\nLoading **all source files** or dumping entire repositories into the agent's context overwhelms the model, introduces noise, and slows inference. Coding agents need to focus on **only the most relevant modules** to efficiently reason about changes or generate new functionality.\n\n- Including every file biases the agent with irrelevant code; it \"loses coherence\" over large contexts.\n- Large contexts inflate token usage, slowing down multi-turn RL training.\n\n## Solution\n\nMaintain a **minimal, high-signal code context** (keeping the context \"sterile\") for the main coding agent by:\n\n**1. Context Sterilization**\n- Exclude unrelated modules (e.g., test utilities when working on a UI component).\n- Automatically identify relevant files via a lightweight **search agent** that returns top-K matches for a function or class name.\n\n**2. Helper Subagent for Code Discovery**\n- Spawn a **SearchSubagent** (a small LLM or vector-search index) that takes a file path or query (e.g., \"find definitions of `UserModel`\") and returns a ranked list of file snippets.\n- Only top-3 snippets (each â‰¤ 150 tokens) are injected into the main agent's context.\n\n**3. Context Update Cycle**\n- **Main Agent:** \"I need to refactor `UserService`.\"\n- **SearchSubagent:** \"Found `user_service.py`, `models/user.py`, `utils/auth.py`.\"\n- **Context Injection:** Only those three files (or their summaries) enter the main agent's window.\n\n## Example\n\n```mermaid\nsequenceDiagram\n    MainAgent->>SearchSubagent: \"Find files defining UserModel\"\n    SearchSubagent-->>MainAgent: List of 3 file paths/snippets\n    MainAgent->>Context: Inject these three code snippets only\n    MainAgent->>Tool: edit_file(UserService)\n```\n\n## How to use it\n\n- **Indexing Stage (Offline):** Build a simple **code index** (e.g., with `ripgrep` or a vector store) to map function/class names to file paths.\n- **Subagent Definition:** Define `SearchSubagent` as a function that queries the code index and uses a small LLM to filter and rank matches.\n- **Context Management Library:** Create a wrapper (e.g., `CuratedContextManager`) that automatically invokes `SearchSubagent` when the main agent asks for relevant code.\n\n## Trade-offs\n\n- **Pros:**\n  - **Noise Reduction:** Keeps the context focused on pertinent code, improving reasoning clarity.\n  - **Token Efficiency:** Dramatically reduces tokens consumed per step, boosting RL throughput.\n  - **Context Anxiety Mitigation:** Helps prevent [context window anxiety](context-window-anxiety-management.md) by keeping usage well below limits.\n- **Cons/Considerations:**\n  - **Index Freshness:** If code changes frequently, the index must be updated to avoid stale results.\n  - **Complexity:** Adds an extra component (SearchSubagent + index) to the training and inference pipeline.\n  - **Model Adaptation Required:** Different models may have varying tolerance for curated vs. full context approaches.\n\n## References\n\n- \"Context is sacred\" principle from the Open Source Agent RL talk (May 2025).\n- Will Brown's commentary on \"avoiding blowing up your context length\" for long-horizon tasks.\n- [Thorsten Ball's \"Raising An Agent - Episode 3\"](https://www.nibzard.com/ampcode) - Production-validated implementation of dedicated search agent pattern.\n"
}