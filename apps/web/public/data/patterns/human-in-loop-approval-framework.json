{
  "title": "Human-in-the-Loop Approval Framework",
  "status": "validated-in-production",
  "authors": ["Nikola Balic (@nibzard)"],
  "based_on": ["Dexter Horthy (HumanLayer)"],
  "category": "UX & Collaboration",
  "source": "https://claude.com/blog/building-companies-with-claude-code",
  "tags": [
    "human-oversight",
    "safety",
    "approvals",
    "risk-management",
    "collaboration",
    "slack-integration"
  ],
  "slug": "human-in-loop-approval-framework",
  "id": "human-in-the-loop-approval-framework",
  "summary": "Systematically insert human approval gates for designated high-risk functions while maintaining agent autonomy for safe operations, with multi-channel approval interfaces and comprehensive audit trails.",
  "updated_at": "2026-01-05",
  "body": "\n## Problem\n\nAutonomous AI agents need to execute high-risk or irreversible operations (database modifications, production deployments, system configurations, API calls) but allowing unsupervised execution creates unacceptable safety and compliance risks. Blocking all such operations defeats the purpose of agent automation.\n\n## Solution\n\nSystematically insert human approval gates for designated high-risk functions while maintaining agent autonomy for safe operations. Create lightweight feedback loops that enable time-sensitive human decisions without blocking the entire agent workflow.\n\n**Core components:**\n\n**Risk classification:**\n\n- Identify functions that require human approval\n- Define approval criteria (cost thresholds, data sensitivity, reversibility)\n- Categorize operations by risk level\n\n**Multi-channel approval interface:**\n\n- Slack integration for real-time notifications\n- Email for asynchronous approvals\n- SMS for urgent/critical operations\n- Web dashboard for batch reviews\n\n**Approval workflow:**\n\n- Agent requests permission before executing risky function\n- Human receives context-rich approval request\n- Quick approve/reject/modify decision\n- Agent proceeds or adapts based on response\n\n**Audit trail:**\n\n- Log all approval requests and responses\n- Track who approved what and when\n- Enable compliance and debugging\n\n```mermaid\nsequenceDiagram\n    participant Agent as AI Agent\n    participant Framework as Approval Framework\n    participant Slack as Slack Channel\n    participant Human as Human Reviewer\n    participant DB as Database\n\n    Agent->>Framework: Request: DROP old_users table\n    Framework->>Framework: Classify as HIGH RISK\n    Framework->>Slack: Send approval request with context\n    Slack->>Human: Notification with approve/reject buttons\n\n    alt Approved\n        Human->>Slack: Click \"Approve\"\n        Slack->>Framework: Approval granted\n        Framework->>Agent: Permission granted\n        Agent->>DB: Execute DROP table\n        Framework->>Framework: Log approval & execution\n    else Rejected\n        Human->>Slack: Click \"Reject + provide reason\"\n        Slack->>Framework: Rejection + context\n        Framework->>Agent: Permission denied + reason\n        Agent->>Agent: Adapt plan (skip or find alternative)\n    end\n```\n\n## How to use it\n\n**When to apply:**\n\n- Production database operations (DELETE, DROP, ALTER)\n- External API calls with side effects (payments, emails, webhooks)\n- System configuration changes (firewall rules, permissions)\n- Destructive file operations (bulk deletes, overwrites)\n- Compliance-sensitive operations (GDPR, HIPAA, SOC2)\n\n**Implementation example (HumanLayer approach):**\n\n**1. Instrument risky functions:**\n\n```python\nfrom humanlayer import HumanLayer\n\nhl = HumanLayer()\n\n@hl.require_approval(channel=\"slack\")\ndef delete_user_data(user_id: str):\n    \"\"\"Delete all data for user - requires approval\"\"\"\n    return db.users.delete(user_id)\n\n# Agent calls function normally\ndelete_user_data(\"user_123\")\n# Execution pauses, approval request sent to Slack\n# Resumes after human approval/rejection\n```\n\n**2. Configure approval channels:**\n\n```yaml\napproval_channels:\n  high_risk:\n    \n- slack: \"#agent-approvals\"\n    - sms: \"+1234567890\"  # For urgent\n  medium_risk:\n    \n- slack: \"#agent-review\"\n  low_risk:\n    \n- email: \"team@company.com\"\n```\n\n**3. Set context requirements:**\n\n- Why is the operation needed?\n- What data will be affected?\n- Is it reversible?\n- What are the alternatives?\n\n**Prerequisites:**\n\n- Integration with communication platforms (Slack, email, SMS)\n- Clear risk classification criteria\n- Fast human response time for time-sensitive operations\n- Fallback strategies when approval is denied\n\n## Trade-offs\n\n**Pros:**\n\n- Enables safe autonomous execution of risky operations\n- Maintains human oversight where it matters most\n- Lightweight integration (Slack buttons, not complex UIs)\n- Audit trail for compliance and debugging\n- Reduces agent anxiety about mistakes\n- Allows gradual trust expansion over time\n\n**Cons:**\n\n- Requires human availability and responsiveness\n- Can bottleneck agent workflows if approvals are slow\n- Infrastructure complexity (notification systems, state management)\n- Risk of approval fatigue leading to rubber-stamping\n- Requires clear classification of what needs approval\n- May interrupt human focus with frequent requests\n\n## References\n\n- [Building Companies with Claude Code](https://claude.com/blog/building-companies-with-claude-code) - HumanLayer's core product coordinates agent actions with \"human approval steps\" via Slack\n- [HumanLayer Documentation](https://docs.humanlayer.dev/) - Framework and examples for human-in-the-loop agent workflows\n- [12-Factor Agents](https://github.com/humanlayer/12-factor-agents) - Principles for production agent systems including human oversight patterns\n- Related patterns: [Spectrum of Control / Blended Initiative](spectrum-of-control.md), [Chain-of-Thought Monitoring & Interruption](chain-of-thought-monitoring-interruption.md)\n"
}
