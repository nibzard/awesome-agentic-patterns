{
  "title": "Plan-Then-Execute Pattern",
  "status": "emerging",
  "authors": ["Nikola Balic (@nibzard)"],
  "based_on": ["Luca Beurer-Kellner et al. (2025)"],
  "category": "Orchestration & Control",
  "source": "https://arxiv.org/abs/2506.08837",
  "tags": ["planning", "control-flow-integrity", "prompt-injection"],
  "slug": "plan-then-execute-pattern",
  "id": "plan-then-execute-pattern",
  "summary": "## Problem\nIf tool outputs can alter the *choice* of later actions, injected instructions may redirect the agent toward malicious steps.",
  "updated_at": "2026-01-05",
  "body": "\n## Problem\nIf tool outputs can alter the *choice* of later actions, injected instructions may redirect the agent toward malicious steps.\n\n## Solution\nSplit reasoning into two phases:\n\n1. **Plan phase** – LLM generates a *fixed* sequence of tool calls **before** it sees any untrusted data.  \n2. **Execution phase** – Controller runs that exact sequence. Tool outputs may shape *parameters*, but **cannot change which tools run**.\n\n```pseudo\nplan = LLM.make_plan(prompt)      # frozen list of calls\nfor call in plan:\n    result = tools.run(call)\n    stash(result)                 # outputs isolated from planner\n```\n\n## How to use it\n\nGreat for email-and-calendar bots, SQL assistants, code-review helpers—any task where the action set is known but parameters vary.\n\n### Claude Code Plan Mode\n\nClaude Code implements this pattern through \"plan mode\" which shifts the agent into planning-only mode:\n\n1. **User shifts to plan mode**: Explicitly request planning (e.g., shift+tab in Claude Code CLI)\n2. **Agent generates detailed plan**: Creates step-by-step approach without executing\n3. **Human reviews and approves**: Can modify plan before execution\n4. **Execution phase**: Agent follows the approved plan\n\n**Effectiveness:**\n\n- Can **2-3x success rates** for complex tasks by aligning on approach first\n- Prevents wasted work from wrong assumptions\n- Allows human expertise to guide agent execution\n\n**Dynamic boundary:**\n\nThe threshold of what requires planning changes with each model generation:\n\n> \"The boundary changes with every model in a surprising way. Newer models are more intelligent, so the boundary of what you need plan mode for got pushed out a little bit. Before you used to need to plan, now you don't.\" —Boris Cherny (Anthropic)\n\nThis means simpler tasks that once required planning can now be one-shot with more capable models (e.g., Sonnet 4.5 vs. Opus 4.1).\n\n## Trade-offs\n\n* **Pros:** Strong control-flow integrity; moderate flexibility.\n* **Cons:** Content of outputs can still be poisoned (e.g., bad email body).\n\n## References\n\n* Beurer-Kellner et al., §3.1 (2) Plan-Then-Execute.\n* Boris Cherny (Anthropic): \"Plan mode... you kind of have to understand the limits and where you get in the loop. Plan mode can 2-3x success rates pretty easily if you align on the plan first.\"\n* Boris Cherny: \"The boundary changes with every model... newer models are more intelligent so the boundary of what you need plan mode for got pushed out.\"\n* [AI & I Podcast: How to Use Claude Code Like the People Who Built It](https://every.to/podcast/transcript-how-to-use-claude-code-like-the-people-who-built-it)\n"
}
