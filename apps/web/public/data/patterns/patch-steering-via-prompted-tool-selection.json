{
  "title": "Patch Steering via Prompted Tool Selection",
  "status": "best-practice",
  "authors": ["Nikola Balic (@nibzard)"],
  "based_on": ["Boris Cherny (Claude Code Concepts)", "Will Brown (Prime Intellect Talk)"],
  "category": "Tool Use & Environment",
  "source": "https://www.youtube.com/watch?v=Xkwok_XXQgw",
  "tags": ["patching", "prompt-steering", "tool-selection", "coding-agent"],
  "slug": "patch-steering-via-prompted-tool-selection",
  "id": "patch-steering-via-prompted-tool-selection",
  "summary": "TODO: Add a concise summary for \"Patch Steering via Prompted Tool Selection\" describing the pattern's purpose and key benefits.",
  "updated_at": "2026-01-05",
  "body": "\n## Problem\n\nCoding agents with access to multiple patching or refactoring tools (e.g., `apply_patch`, `AST-refactorer`, `codemod`) may choose suboptimal tools if not explicitly guided. This leads to:\n\n- **Unnecessary Complexity:** Agent might use a generic text-replace tool instead of a specialized AST-aware refactoring tool.\n- **Inconsistent Results:** Without explicit instructions, the agent's tool selection can vary unpredictably, hampering reproducibility.\n\n## Solution\n\n**Steer** the agent's tool selection and patch approach through **explicit natural language instructions** in the prompt. Techniques include:\n\n**1. Direct Tool Invocation**\n- Prepend: \"Use the `apply_patch` tool to insert a new function `validate_input` in `auth_service.py`.\"\n- The agent recognizes \"apply_patch\" as the preferred patching mechanism.\n\n**2. Tool Usage Teaching**\n- Provide a mini-manual in the context:\n  ```text\n  \"Our `ASTRefactor` tool takes JSON describing node edits:  \n  {\"file\": string, \"pattern\": string, \"replacement\": string}.  \n  Use it for safe refactors rather than raw `sed` commands.\"  \n  ```\n- This orients the agent to use the safer, higher-level refactoring tool when modifying function signatures or renaming classes.\n\n**3. Implicit Shorthands**\n- Introduce domain-specific abbreviations: \"When instructing to rename variables, say `renameVar(old, new)`; the agent maps this to the ASTRefactor tool under the hood.\"\n\n**4. Reason-Encouraging Phrases**\n- Add: \"Think about type safety before choosing a patch tool.\"\n- Promotes deeper reasoning so the agent doesn't just apply surface-level text replacements.\n\n## Example\n\n```mermaid\nflowchart TD\n    A[User Prompt: \"Refactor validation logic\"] --> B[Augmented Prompt]\n    B --> C[\"Please use ASTRefactor to update function signatures\"]\n    C --> D[Agent selects ASTRefactor]\n    D --> E[ASTRefactorTool patches code]\n```\n\n## How to use it\n\n- **Tool Registry:** Expose tool metadata (name, usage example, input schema) in the agent's initialization context.\n- **Prompt Templates:** Create reusable templates with placeholders, e.g.:\n  ```\n  \"Task: {task_description}. Preferred tool: {tool_name}.  \n  Usage example: {tool_usage_snippet}.\"\n  ```\n- **Fallback Handling:** If the agent ignores the instruction and uses the wrong tool, include a directive: \"If ASTRefactor fails, fallback to apply_patch.\"\n\n## Trade-offs\n\n- **Pros:**\n  - **Predictable Behavior:** Reduces variance in tool usage for the same task.\n  - **Higher Code Quality:** Ensures the agent uses semantically safe tools (e.g., AST-based) over string-based replacements.\n- **Cons/Considerations:**\n  - **Prompt Length:** Excessive tool documentation in the prompt can consume valuable tokens.\n  - **Maintenance:** As new patching tools emerge, templates and tool registry need periodic updates.\n\n## References\n\n- Adapted from \"Tool Use Steering via Prompting\" in Claude Code best practices.\n- Will Brown's notes on \"if you want it to be a tool use agent\" you must decide that's the default behavior in the prompt.\n"
}
