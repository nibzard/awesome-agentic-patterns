{
  "title": "Progressive Disclosure for Large Files",
  "status": "emerging",
  "authors": ["Nikola Balic (@nibzard)"],
  "based_on": ["Will Larson (lethain.com)"],
  "category": "Context & Memory",
  "source": "https://lethain.com/agents-large-files/",
  "tags": [
    "progressive-disclosure",
    "large-files",
    "context-optimization",
    "file-management",
    "lazy-loading",
    "file-handling",
    "metadata"
  ],
  "slug": "progressive-disclosure-large-files",
  "id": "progressive-disclosure-for-large-files",
  "summary": "TODO: Add a concise summary for \"Progressive Disclosure for Large Files\" describing the pattern's purpose and key benefits.",
  "updated_at": "2026-01-13",
  "body": "\n## Problem\n\nLarge files (PDFs, DOCXs, images) overwhelm the context window when loaded naively. A 5-10MB PDF may contain only 10-20KB of relevant text/tables, but the entire file is often shoved into context, wasting tokens and degrading performance.\n\n## Solution\n\nApply **progressive disclosure**: load file metadata first, then provide tools to load content on-demand.\n\n**Core approach:**\n\n1. **Always include file metadata** in the prompt (not full content):\n\n   ```\n   Files:\n     - id: f_a1\n       name: my_image.png\n       size: 500,000\n       preloaded: false\n     - id: f_b3\n       name: report.pdf\n       size: 8500000\n       preloaded: false\n   ```\n\n2. **Optionally preload first N KB** of appropriate mimetypes (configurable per-workflow, can be 0)\n\n3. **Provide three file operations:**\n\n   - `load_file(id)` - Load entire file into context\n   - `peek_file(id, start, stop)` - Load a section of file\n   - `extract_file(id)` - Transform PDF/DOCX/PPT into simplified text\n\n4. **Include a `large_files` skill** explaining when/how to use these tools\n\n```pseudo\n# Agent workflow for document comparison\n1. Prompt includes file metadata for report_2024.pdf and report_2025.pdf\n2. Agent sees large PDFs, checks large_files skill\n3. Agent calls: extract_file(\"report_2024.pdf\")\n4. Agent calls: extract_file(\"report_2025.pdf\")\n5. Agent compares extracted summaries using minimal context\n```\n\n```pseudo\n# Agent workflow for image analysis\n1. Prompt includes metadata for screenshot.png\n2. Agent sees PNG type, calls: load_file(\"screenshot.png\")\n3. Image content is loaded, agent analyzes visual content\n```\n\n## How to use it\n\n**Best for:**\n\n- Document comparison workflows (multiple PDFs)\n- Ticket systems with file attachments (images, PDFs)\n- Data export analysis (large reports in various formats)\n- Any workflow where agents need file content but files are large\n\n**Implementation considerations:**\n\n- File `id` should be a stable reference for tool calls\n- `extract_file` should return simplified text (tables, text content)\n- Consider making `extract_file` return a virtual `file_id` for very large extractions\n- Preloading first N KB is optional - can give agent initial context without full load\n\n**Tool design:**\n\n```python\ndef load_file(file_id: str) -> str:\n    \"\"\"Load entire file content into context window.\"\"\"\n\ndef peek_file(file_id: str, start: int, stop: int) -> str:\n    \"\"\"Load a specific byte range from file.\"\"\"\n\ndef extract_file(file_id: str) -> str:\n    \"\"\"Convert PDF/DOCX/PPT to simplified text representation.\"\"\"\n```\n\n## Trade-offs\n\n**Pros:**\n\n- Enables working with files much larger than context window\n- Agent has control over what/when to load\n- Reusable across workflows via `large_files` skill\n- Extracted content is often 100x smaller than original file\n\n**Cons:**\n\n- Adds tool call overhead (multiple round-trips)\n- Requires preloading heuristics (how much is enough?)\n- Extraction from complex formats (DOCX) can be slow without native dependencies\n- Agent may make poor loading decisions without proper guidance\n\n**Trade-offs in preloading:**\n\n- **Preloading**: Gives agent immediate context but reduces control\n- **No preloading**: Maximum agent control but requires explicit load calls\n\n## References\n\n* [Building an internal agent: Progressive disclosure and handling large files](https://lethain.com/agents-large-files/) - Will Larson (2025)\n* Related: [Progressive Tool Discovery](progressive-tool-discovery.md) - Similar lazy-loading concept for tools\n* Related: [Context-Minimization Pattern](context-minimization-pattern.md) - Complementary pattern for reducing context bloat\n"
}
